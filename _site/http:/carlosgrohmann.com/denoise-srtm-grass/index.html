<!DOCTYPE html>
<html lang="en">
  <!-- Beautiful Jekyll | MIT license | Copyright Dean Attali 2016 -->
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover">

  <title>Denoising SRTM with GRASS-GIS</title>

  <meta name="author" content="Carlos H. Grohmann" />

  

  <link rel="alternate" type="application/rss+xml" title="Prof. Carlos H. Grohmann - Personal website of Prof. Carlos H. Grohmann (IEE-USP, Brazil)" href="/feed.xml" />

  

  

  


  
    
      
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.0/css/font-awesome.min.css" />


    
  

  
    
      <link rel="stylesheet" href="/css/bootstrap.min.css" />
    
      <link rel="stylesheet" href="/css/bootstrap-social.css" />
    
      <link rel="stylesheet" href="/css/main.css" />
    
  

  
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
    
  

  

  

  

    <!-- Facebook OpenGraph tags -->
  

  
  <meta property="og:title" content="Denoising SRTM with GRASS-GIS" />
  

   
  <meta property="og:description" content="Digital elevation data usually has some noise in it, but removing that noise may not be as easy as a simple filtering procedure. Using raster filters (mean, mode etc) in moving-windows operations will smooth the original topography. One solution is to perform the filtering with the XYZ information of each...">
  


  <meta property="og:type" content="website" />

  
  <meta property="og:url" content="http://localhost:4000/http:/carlosgrohmann.com/denoise-srtm-grass/" />
  <link rel="canonical" href="http://localhost:4000/http:/carlosgrohmann.com/denoise-srtm-grass/" />
  

  
  <meta property="og:image" content="http://localhost:4000/img/doodle_crop.jpg" />
  


  <!-- Twitter summary cards -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <meta name="twitter:creator" content="@" />

  
  <meta name="twitter:title" content="Denoising SRTM with GRASS-GIS" />
  

  
  <meta name="twitter:description" content="Digital elevation data usually has some noise in it, but removing that noise may not be as easy as a simple filtering procedure. Using raster filters (mean, mode etc) in moving-windows operations will smooth the original topography. One solution is to perform the filtering with the XYZ information of each...">
  

  
  <meta name="twitter:image" content="http://localhost:4000/img/doodle_crop.jpg" />
  

  

  

</head>


  <body>

    

  
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
        <a class="navbar-brand" href="http://localhost:4000">Prof. Carlos H. Grohmann</a>
      
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
      
        
          <li>
            





  
  <a href="/index">Home</a>




          </li>
        
        
        
          <li class="navlinks-container">
            <a class="navlinks-parent" href="javascript:void(0)">About Me</a>
            <div class="navlinks-children">
              
                
                  





  
  <a href="/aboutme">Bio|CV</a>




                
              
                
                  





  
  <a href="/photos">Photos</a>




                
              
                
                  





  
  <a href="/gmaps">Map</a>




                
              
            </div>
          </li>
        
        
        
          <li class="navlinks-container">
            <a class="navlinks-parent" href="javascript:void(0)">Research</a>
            <div class="navlinks-children">
              
                
                  





  
  <a href="/grants">Projects</a>




                
              
                
                  





  
  <a href="/students">Students</a>




                
              
                
                  





  
  <a rel="noopener noreferrer" target="_blank" href="https://spamlab.github.io">SPAM!(Lab)</a>




                
              
            </div>
          </li>
        
        
        
          <li>
            





  
  <a href="/publications">Publications</a>




          </li>
        
        
        
          <li class="navlinks-container">
            <a class="navlinks-parent" href="javascript:void(0)">Blog</a>
            <div class="navlinks-children">
              
                
                  





  
  <a href="/blog">Posts</a>




                
              
                
                  





  
  <a href="/tags">Tags</a>




                
              
            </div>
          </li>
        
        
        
          <li>
            





  
  <a href="/search">?</a>




          </li>
        
        
      </ul>
    </div>

	
	<div class="avatar-container">
	  <div class="avatar-img-border">
	    <a href="http://localhost:4000">
	      <img class="avatar-img" src="/img/doodle_crop.jpg" />
		</a>
	  </div>
	</div>
	

  </div>
</nav>


    <!-- TODO this file has become a mess, refactor it -->





<header class="header-section ">

<div class="intro-header no-img">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-heading">
          <h1>Denoising SRTM with GRASS-GIS</h1>
		  
		  
		  
		  <span class="post-meta">Posted on December 6, 2016</span>
		  
        </div>
      </div>
    </div>
  </div>
</div>
</header>





<div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

      

      <article role="main" class="blog-post">
        <p>Digital elevation data usually has some noise in it, but removing that noise may not be as easy as a simple filtering procedure. Using raster filters (mean, mode etc) in moving-windows operations will smooth the original topography. One solution is to perform the filtering with the XYZ information of each pixel (that is, treating the DEM as a point cloud and filtering the vector points). In GRASS-GIS, we can use the <strong>r.denoise</strong> add-on to do this. The module was originally a bash script that I ported to python (because I needed to call it from a python script, and the bash version wasn’t working this way). The module itself is just a wrapper to the <strong>mdenoise</strong> (Sun et al., 2007; Stevenson et al., 20109) executable, which needs to be installed and in the system PATH. To do that, download the source code of mdenoise and compile it:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget http://www.cs.cf.ac.uk/meshfiltering/index_files/Doc/mdsource.zip

unzip mdsource.zip

cd mdenoise

g++ -o mdenoise mdenoise.cpp triangle.c

ln -s `pwd`/mdenoise /some/directory/on/the/$PATH
</code></pre></div></div>

<p>  Once <strong>mdenoise</strong> is installed, start a GRASS session and install the add-on with <a rel="noopener noreferrer" target="_blank" href="https://grass.osgeo.org/grass72/manuals/g.extension.html">g.extension</a>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>g.extension r.denoise
</code></pre></div></div>

<p>  In this post, I’ll show an example with 1-arcsec SRTM data for an area in the Amazon region, just north of the Barcelos city.   [caption id=”attachment_1455” align=”alignnone” width=”300”]<img src="/blog/wp-content/uploads/2016/12/map-300x191.png" alt="location map" /> Location of the test area, in the Brazilian Amazon[/caption] Let’s check the original SRTM data.</p>

<p>In the image below, I used d.shade to drape the SRTM raster over a shaded relief image.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>r.relief --overwrite input=srtm30m_north output=srtm30m_north_dnoise_shade_25_315_z5 altitude=25 azimuth=315 zscale=5



d.shade shade=srtm30m_north_shade_25_315_z5 color=srtm30m_north
</code></pre></div></div>

<p>  [caption id=”attachment_1454” align=”alignnone” width=”600”]<img src="/blog/wp-content/uploads/2016/12/Screen-Shot-2016-12-06-at-11.35.23-1024x784.jpg" alt="screen-shot-2016-12-06-at-11-35-23" /> Original 1-arcsec SRTM data[/caption] We can see the noise in the image. Of course, some of it is probably due the forest canopy structure, but certainly not all. Let’s run the <strong>r.denoise</strong> module and see the results. First, check the region settings:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GRASS 7.2.0svn (latlong):~&gt; g.region -p raster=srtm30m_north

projection: 3 (Latitude-Longitude)

zone: 0

datum: wgs84

ellipsoid: wgs84

north: 0:05:53S

south: 0:13:58S

west: 62:50:42W

east: 62:38:53W

nsres: 0:00:01

ewres: 0:00:01

rows: 485

cols: 709

cells: 343865
</code></pre></div></div>

<p>  Now run the module. The <strong>mdenoise</strong> executable does not work with geographic coordinates, and since I am working on a latitude-longitude location, I need to supply an EPSG code of a projected coordinate system, which will be used for reprojecting the data to a temporary file. In this case I used EPSG=32720, the code for UTM 20S WGS84. We need to define two parameters, <strong>iterations</strong> and <strong>threshold</strong>. From the help page:</p>

<blockquote>
  <p>The amount of smoothing is controlled by the <em>threshold</em> and <em>iterations</em> parameters. Increasing the <em>threshold</em> decreases how sharp a feature needs to be to be preserved e.g. decreases the smoothing. To preserve ridge crests in mountain areas, T &gt; 0.9 is recommended. Setting T too high results in the preservation of noise. For SRTM data, which is already partly smoothed by NASA, T = 0.99 can be used. Increasing the number of <em>iterations</em> increases the smoothing and the range of spatial correlation of the output dataset. A small number, e.g. 5 or fewer, typically gives the best results.</p>
</blockquote>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>r.denoise --overwrite input=srtm30m_north output=srtm30m_north_dnoise iterations=5 threshold=0.9 epsg=32720
</code></pre></div></div>

<p>  Here’s the output of the command. For this test area, it took less than 5 seconds to denoise (10 seconds total) on my iMac (4 GHz, 32 GB RAM).</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Exporting points...

Projecting...

Denoising...

Input File: tmp_xyz_proj_16395.xyz

Neighbourhood: Common Vertex

Threshold: 0.900000

n1: 5

n2: 50

Read Model...

Triangulation...

0.932 seconds

Denoising Model... 5.151 seconds

Saving Model... 0.186 seconds

Reloading data...

Reading input data...

Writing to output raster map...

r.in.xyz complete. 343865 points found in region.

Removing temporary files...

Removing temporary files...

(Tue Dec 6 11:26:10 2016) Command finished (10 sec)
</code></pre></div></div>

<p>  To check the results visually, we can make the same color-shaded composition that we used for the original data:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>r.colors map=srtm30m_north_dnoise@RAM raster=srtm30m_north@RAM



r.relief --overwrite input=srtm30m_north_dnoise output=srtm30m_north_dnoise_shade_25_315_z5 altitude=25 azimuth=315 zscale=5



d.shade shade=srtm30m_north_dnoise_shade_25_315_z5 color=srtm30m_north_dnoise
</code></pre></div></div>

<p>  [caption id=”attachment_1453” align=”alignnone” width=”600”]<img src="/blog/wp-content/uploads/2016/12/Screen-Shot-2016-12-06-at-11.34.36-1024x784.jpg" alt="screen-shot-2016-12-06-at-11-34-36" /> SRTM after denoising[/caption]   In GRASS we can use the <a rel="noopener noreferrer" target="_blank" href="https://grass.osgeo.org/grass70/manuals/g.gui.mapswipe.html">g.gui.mapswipe</a> module to interactively compares two maps by swiping a visibility bar. For this blog post, I used the <a rel="noopener noreferrer" target="_blank" href="https://wordpress.org/plugins/twenty20/">Twenty20</a> plugin to get the same effect: [twenty20 img1=”1454” img2=”1453” offset=”0.5”]   Some quick stats from <a rel="noopener noreferrer" target="_blank" href="https://grass.osgeo.org/grass70/manuals/r.info">r.info</a> will show us that the range of elevation values changed a bit:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GRASS 7.2.0svn (latlong):~ &gt; r.info srtm30m_north

 +----------------------------------------------------------------------------+

 | Map:      srtm30m_north                  Date: Wed Jan 14 14:32:07 2015    |

 | Mapset:   RAM                            Login of Creator: guano           |

 | Location: latlong                                                          |

 | DataBase: /Volumes/MacintoshHD2/grassdata                                  |

 | Title:    S01W063.SRTMGL1                                                  |

 | Timestamp: none                                                            |

 |----------------------------------------------------------------------------|

 |                                                                            |

 |   Type of Map:  raster               Number of Categories: 0               |

 |   Data Type:    CELL                                                       |

 |   Rows:         485                                                        |

 |   Columns:      709                                                        |

 |   Total Cells:  343865                                                     |

 |        Projection: Latitude-Longitude                                      |

 |            N:   0:05:53S    S:   0:13:58S   Res: 0:00:01                   |

 |            E:  62:38:53W    W:  62:50:42W   Res: 0:00:01                   |

 |   Range of data:    min = 8  max = 76                                      |

 |                                                                            |

 |   Data Description:                                                        |

 |    generated by r.in.gdal                                                  |

 |                                                                            |

 |   Comments:                                                                |

 |    r.in.gdal input="S01W063.SRTMGL1.bil" output="S01W063.SRTMGL1"          |

 |    r.in.srtm "-1" "input=/Users/guano/Desktop/S01W063.SRTMGL1"             |
</code></pre></div></div>

      </article>

      

      
        <!-- Check if any share-links are active -->




<section id = "social-share-section">
  <span class="sr-only">Share: </span>

  
  <!--- Share on Twitter -->
    <a rel="noopener noreferrer" target="_blank" href="https://twitter.com/intent/tweet?text=Denoising+SRTM+with+GRASS-GIS+http://localhost:4000/http:/carlosgrohmann.com/denoise-srtm-grass/"
      class="btn btn-social-icon btn-twitter" title="Share on Twitter">
      <span class="fa fa-fw fa-twitter" aria-hidden="true"></span>
      <span class="sr-only">Twitter</span>
    </a>
  

  
  <!--- Share on Facebook -->
    <a rel="noopener noreferrer" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/http:/carlosgrohmann.com/denoise-srtm-grass/"
      class="btn btn-social-icon btn-facebook" title="Share on Facebook">
      <span class="fa fa-fw fa-facebook" aria-hidden="true"></span>
      <span class="sr-only">Facebook</span>
    </a>
  

  
  <!--- Share on Google Plus -->
    <a rel="noopener noreferrer" target="_blank" href="https://plus.google.com/share?url=http://localhost:4000/http:/carlosgrohmann.com/denoise-srtm-grass/"
      class="btn btn-social-icon btn-google" title="Share on Google+">
      <span class="fa fa-fw fa-google-plus" aria-hidden="true"></span>
      <span class="sr-only">Google+</span>
    </a>
  

  

</section>



      

      <ul class="pager blog-pager">
        
        <li class="previous">
          <a href="/http:/carlosgrohmann.com/curso-internacional-de-espeleoresgate-2016/" data-toggle="tooltip" data-placement="top" title="Curso Internacional de Espeleoresgate 2016">&larr; Previous Post</a>
        </li>
        
        
        <li class="next">
          <a href="/http:/carlosgrohmann.com/i-deleted-my-account-at-academia-edu/" data-toggle="tooltip" data-placement="top" title="I deleted my account at Academia.edu">Next Post &rarr;</a>
        </li>
        
      </ul>

      
        <div class="disqus-comments">
          
        </div>
          
        <div class="staticman-comments">
          

        </div>
      
    </div>
  </div>
</div>


    <footer>
  <div class="container beautiful-jekyll-footer">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links"><li><a href="/feed.xml" title="RSS"><span class="fa-stack fa-lg" aria-hidden="true">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                </span>
                <span class="sr-only">RSS</span>
              </a>
            </li><li><a href="https://github.com/CarlosGrohmann" title="GitHub"><span class="fa-stack fa-lg" aria-hidden="true">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                </span>
                <span class="sr-only">GitHub</span>
              </a>
            </li><li><a href="https://twitter.com/CarlosGrohmann" title="Twitter"><span class="fa-stack fa-lg" aria-hidden="true">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                </span>
                <span class="sr-only">Twitter</span>
              </a>
            </li><li><a href="https://www.instagram.com/CarlosGrohmann" title="Instagram"><span class="fa-stack fa-lg" aria-hidden="true">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-instagram fa-stack-1x fa-inverse"></i>
                </span>
                <span class="sr-only">Instagram</span>
              </a>
            </li></ul>
      <p class="copyright text-muted">
      Carlos H. Grohmann
      &nbsp;&bull;&nbsp;
      2019

      
      &nbsp;&bull;&nbsp;
      <a href="http://localhost:4000">carlosgrohmann.com</a>
      

      
      </p>
          <!-- Please don't remove this, keep my open source work credited :) -->
    <p class="theme-by text-muted">
      Theme by
      <a href="https://deanattali.com/beautiful-jekyll/">beautiful-jekyll</a>
    </p>
      </div>
    </div>
  </div>
</footer>

  
    






  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script>
      	if (typeof jQuery == 'undefined') {
      	  document.write('<script src="/js/jquery-1.11.2.min.js"></scr' + 'ipt>');
      	}
      </script>
    
  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
	<script src="/js/bootstrap.min.js"></script>
    
  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
	<script src="/js/main.js"></script>
    
  


  
  </body>
</html>
